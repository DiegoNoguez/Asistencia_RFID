<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Editar Alumnos</title>
  <link rel="stylesheet" href="/static/css/admin.css">
</head>
<body>
  <div class="login-container">
    <h2>Editar Alumnos del Grupo 3401</h2>
    <form id="formAgregar">
      <input type="text" id="matricula" placeholder="Matrícula" required>
      <input type="text" id="nombre" placeholder="Nombre" required>
      <input type="text" id="ape1" placeholder="Apellido Paterno" required>
      <input type="text" id="ape2" placeholder="Apellido Materno">
      <input type="text" id="password" placeholder="password" required>
      <input type="text" id="tarjeta" placeholder="Tarjeta RFID" required>
      <button type="submit">Agregar Alumno</button>
    </form>
    <table style="width:100%; margin-top:20px;" border="1">
      <thead>
        <tr>
          <th>ID</th>
          <th>Matrícula</th>
          <th>Nombre</th>
          <th>Ape. Paterno</th>
          <th>Ape. Materno</th>
          <th>password</th>
          <th>Tarjeta RFID</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="tablaAlumnos"></tbody>
    </table>
    <a href="/static/admin_panel.html"><button>Volver</button></a>
  </div>
  <script>
  // Cargar alumnos al iniciar
    async function cargarAlumnos() {
      try {
        const response = await fetch('/api/alumnos');
        if (!response.ok) throw new Error('Error al cargar alumnos');

        const alumnos = await response.json();
        const tbody = document.getElementById('tablaAlumnos');
        tbody.innerHTML = '';

        alumnos.forEach(alumno => {
          const fila = document.createElement('tr');
          fila.innerHTML = `
                <td>${alumno.matricula}</td>
                <td>${alumno.matricula}</td>
                <td>${alumno.nombre}</td>
                <td>${alumno.ape1}</td>
                <td>${alumno.ape2 || ''}</td>
                <td>${alumno.password}</td>
                <td>${alumno.claveT || ''}</td>
                <td><button onclick="eliminarAlumno('${alumno.matricula}')">Eliminar</button></td>
            `;
          tbody.appendChild(fila);
        });
      } catch (error) {
        console.error('Error:', error);
        alert('Error al cargar alumnos: ' + error.message);
      }
    }

    // Agregar alumno
    document.getElementById('formAgregar').addEventListener('submit', async (e) => {
      e.preventDefault();

      const nuevoAlumno = {
        matricula: document.getElementById('matricula').value,
        nombre: document.getElementById('nombre').value,
        ape1: document.getElementById('ape1').value,
        ape2: document.getElementById('ape2').value,
        password: document.getElementById('password').value,
        claveT: document.getElementById('tarjeta').value
      };

      try {
        const response = await fetch('/api/alumnos', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(nuevoAlumno)
        });

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.detail || 'Error al agregar alumno');
        }

        await cargarAlumnos();
        e.target.reset();
      } catch (error) {
        alert('Error: ' + error.message);
      }
    });

    // Eliminar alumno (implementa este endpoint en el backend si no existe)
    async function eliminarAlumno(matricula) {
      if (confirm('¿Eliminar este alumno?')) {
        try {
          const response = await fetch(`/api/alumnos/${matricula}`, {
            method: 'DELETE'
          });

          if (!response.ok) throw new Error('Error al eliminar');
          await cargarAlumnos();
        } catch (error) {
          alert('Error: ' + error.message);
        }
      }
    }

    // Iniciar
    window.onload = cargarAlumnos;
  </script>
</body>
</html>


